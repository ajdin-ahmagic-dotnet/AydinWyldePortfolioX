<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Aydin Wylde</title>
    <!-- Add Monoid font from CDN -->
    <link href="https://cdn.jsdelivr.net/gh/larsenwork/monoid/Monoid.css" rel="stylesheet" />
    <link rel="stylesheet" href="~/css/Site.css" />
    <script src="https://code.jquery.com/jquery-3.7.1.min.js" integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css" />
    <!-- Google AdSense (update with your publisher ID) -->
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-XXXXXXXXXXXXXXXX" crossorigin="anonymous"></script>
    <style>
        /* Override font for all elements */
        * {
            font-family: 'Monoid', monospace;
        }
        input, button, textarea, select {
            font-family: 'Monoid', monospace;
        }

    </style>
</head>
<body class="dx-viewport">
    <!-- Professional Loading Screen -->
    <div id="pageLoader" class="page-loader">
        <div class="loader-content">
            <div class="loader-logo">
                <span class="loader-char" data-char="A">A</span>
                <span class="loader-char" data-char="W">W</span>
            </div>
            <div class="loader-bar">
                <div class="loader-progress"></div>
            </div>
            <div class="loader-text">
                <span class="loader-status">Initializing</span>
                <span class="loader-dots">...</span>
            </div>
            <div class="loader-matrix-rain"></div>
        </div>
    </div>

    <canvas id="matrix-bg"></canvas>
    <div class="page-transition" id="pageTransition"></div>

    <!-- Mouse Follower Effects -->
    <div id="mouse-glow" class="mouse-glow"></div>
    <div id="mouse-trail"></div>

    <!-- Admin Panel Modal -->
    <div id="adminModal" class="admin-modal hidden">
        <div class="admin-modal-overlay" onclick="closeAdminModal()"></div>
        <div class="admin-modal-content">
            <button class="admin-modal-close" onclick="closeAdminModal()">×</button>
            
            <!-- Login Screen -->
            <div id="adminLoginScreen" class="admin-screen">
                <div class="admin-login-header">
                    <div class="admin-logo">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h2>Admin Access</h2>
                    <p class="admin-subtitle">Secure Login Portal</p>
                </div>
                
                <div id="loginMessage" class="admin-alert hidden"></div>
                
                <form id="loginForm" class="admin-form" onsubmit="handleLogin(event)">
                    <div class="admin-input-group">
                        <i class="fas fa-user input-icon"></i>
                        <input type="text" id="loginUsername" class="admin-input" placeholder="Username" autocomplete="username" required />
                    </div>
                    
                    <div class="admin-input-group">
                        <i class="fas fa-lock input-icon"></i>
                        <input type="password" id="loginPassword" class="admin-input" placeholder="Password" autocomplete="current-password" required />
                    </div>
                    
                    <button type="submit" class="admin-btn-primary">
                        <i class="fas fa-sign-in-alt"></i> Sign In
                    </button>
                </form>
                
                <div class="admin-login-footer">
                    <p class="hint-text">Press <kbd>Alt</kbd> + <kbd>Shift</kbd> + <kbd>A</kbd> to open this dialog</p>
                </div>
            </div>
            
            <!-- Dashboard Screen -->
            <div id="adminDashboard" class="admin-screen hidden">
                <div class="admin-dashboard-header">
                    <h2><i class="fas fa-tachometer-alt"></i> Admin Dashboard</h2>
                    <button class="admin-btn-secondary" onclick="logoutAdmin()">
                        <i class="fas fa-sign-out-alt"></i> Logout
                    </button>
                </div>
                
                <div class="admin-nav-tabs">
                    <button class="admin-tab-btn active" onclick="switchTab('analytics')">
                        <i class="fas fa-chart-line"></i>
                        <span>Analytics</span>
                    </button>
                    <button class="admin-tab-btn" onclick="switchTab('blog')">
                        <i class="fas fa-blog"></i>
                        <span>Blog Posts</span>
                    </button>
                    <button class="admin-tab-btn" onclick="switchTab('settings')">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </button>
                </div>
                
                <div class="admin-tab-content">
                    <!-- Analytics Tab -->
                    <div id="tab-analytics" class="tab-pane active">
                        <div class="stats-grid">
                            <div class="stat-card">
                                <div class="stat-header">
                                    <i class="fas fa-users"></i>
                                    <span>Today</span>
                                </div>
                                <div class="stat-value" id="stat-today">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <i class="fas fa-calendar-week"></i>
                                    <span>This Week</span>
                                </div>
                                <div class="stat-value" id="stat-week">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <i class="fas fa-calendar-alt"></i>
                                    <span>This Month</span>
                                </div>
                                <div class="stat-value" id="stat-month">0</div>
                            </div>
                            <div class="stat-card">
                                <div class="stat-header">
                                    <i class="fas fa-globe"></i>
                                    <span>All Time</span>
                                </div>
                                <div class="stat-value" id="stat-total">0</div>
                            </div>
                        </div>
                        <div class="analytics-content">
                            <h3>Recent Activity</h3>
                            <div id="recentActivity" class="activity-list"></div>
                        </div>
                    </div>
                    
                    <!-- Blog Tab -->
                    <div id="tab-blog" class="tab-pane">
                        <div class="blog-toolbar">
                            <button class="admin-btn-primary" onclick="showNewPostForm()">
                                <i class="fas fa-plus"></i> New Post
                            </button>
                        </div>
                        <div id="blogPostsList" class="blog-list"></div>
                    </div>
                    
                    <!-- Settings Tab -->
                    <div id="tab-settings" class="tab-pane">
                        <div class="settings-section">
                            <h3>Account Security</h3>
                            <div class="setting-item">
                                <label>Change Password</label>
                                <button class="admin-btn-secondary" onclick="alert('Password change feature - coming soon')">
                                    <i class="fas fa-key"></i> Update Password
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- New/Edit Post Form -->
            <div id="postEditorScreen" class="admin-screen hidden">
                <div class="admin-form-header">
                    <h2><i class="fas fa-edit"></i> <span id="postFormTitle">New Blog Post</span></h2>
                    <button class="admin-btn-secondary" onclick="cancelPostEdit()">
                        <i class="fas fa-times"></i> Cancel
                    </button>
                </div>
                
                <form id="postForm" class="admin-form" onsubmit="savePost(event)">
                    <div class="admin-input-group">
                        <label>Title</label>
                        <input type="text" id="postTitle" class="admin-input" placeholder="Post title" required />
                    </div>
                    
                    <div class="admin-input-group">
                        <label>Category</label>
                        <select id="postCategory" class="admin-input">
                            <option value="ASP.NET Core">ASP.NET Core</option>
                            <option value="C#">C#</option>
                            <option value="Azure">Azure</option>
                            <option value="News">News</option>
                            <option value="Personal">Personal</option>
                        </select>
                    </div>
                    
                    <div class="admin-input-group">
                        <label>Summary</label>
                        <textarea id="postSummary" class="admin-input" rows="2" placeholder="Brief summary"></textarea>
                    </div>
                    
                    <div class="admin-input-group">
                        <label>Content (HTML)</label>
                        <textarea id="postContent" class="admin-input" rows="10" placeholder="Post content..."></textarea>
                    </div>
                    
                    <div class="admin-input-group">
                        <label>Tags (comma separated)</label>
                        <input type="text" id="postTags" class="admin-input" placeholder="tag1, tag2, tag3" />
                    </div>
                    
                    <div class="admin-checkbox-group">
                        <label>
                            <input type="checkbox" id="postFeatured" />
                            <span>Featured Post</span>
                        </label>
                    </div>
                    
                    <input type="hidden" id="postId" />
                    
                    <div class="admin-form-actions">
                        <button type="button" class="admin-btn-secondary" onclick="cancelPostEdit()">
                            <i class="fas fa-times"></i> Cancel
                        </button>
                        <button type="submit" class="admin-btn-primary">
                            <i class="fas fa-save"></i> Save Post
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <header class="layout-header">
        <nav class="main-navigation">
            <div class="nav-container">
                <div class="header-title">Aydin Wylde</div>
                <button class="mobile-menu-toggle" id="mobileMenuToggle">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="nav-menu" id="main-nav">
                    <ul class="main-menu">
                        <li class="main-menu-item">
                            <a href="@Url.Action("Index", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Index" ? "active" : "")">Home</a>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("About", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "About" ? "active" : "")">About</a>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("Skills", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Skills" ? "active" : "")">Skills</a>
                            <div class="dropdown-menu">
                                <a href="@Url.Action("Skills", "Home", new { id = "Backend" })" class="dropdown-item">
                                    <i class="fas fa-server dropdown-icon"></i>
                                    Backend
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Frontend" })" class="dropdown-item">
                                    <i class="fas fa-laptop-code dropdown-icon"></i>
                                    Frontend
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Cloud" })" class="dropdown-item">
                                    <i class="fas fa-cloud dropdown-icon"></i>
                                    Cloud & DevOps
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Architecture" })" class="dropdown-item">
                                    <i class="fas fa-sitemap dropdown-icon"></i>
                                    Architecture
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Databases" })" class="dropdown-item">
                                    <i class="fas fa-database dropdown-icon"></i>
                                    Databases
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Mobile" })" class="dropdown-item">
                                    <i class="fas fa-mobile-alt dropdown-icon"></i>
                                    Mobile Dev
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Certifications" })" class="dropdown-item">
                                    <i class="fas fa-certificate dropdown-icon"></i>
                                    Certifications
                                </a>
                                <a href="@Url.Action("Skills", "Home", new { id = "Tools" })" class="dropdown-item">
                                    <i class="fas fa-tools dropdown-icon"></i>
                                    Tools
                                </a>
                            </div>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("Projects", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Projects" ? "active" : "")">Projects</a>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("Education", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"]?.ToString() == "Education" ? "active" : "")">Education</a>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("Blog", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"].ToString() == "Blog" ? "active" : "")">Blog</a>
                        </li>
                        <li class="main-menu-item">
                            <a href="@Url.Action("Contact", "Home")" class="main-menu-link @(ViewContext.RouteData.Values["Action"].ToString() == "Contact" ? "active" : "")">Contact</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
    </header>

    <div class="parallax-container">
        <main id="content-wrapper">
            <!-- Search Bar -->
            <div class="search-container">
                <form id="searchForm" action="@Url.Action("Search", "Home")" method="get" class="search-form">
                    <i class="fas fa-search search-icon"></i>
                    <input type="text" 
                           class="search-input" 
                           id="globalSearch" 
                           name="q" 
                           placeholder="Search for anything..."
                           autocomplete="off"
                           value="@(Context.Request.Query["q"])" />
                    <div class="search-results" id="searchResults"></div>
                </form>
            </div>

            @RenderBody()
        </main>
        <footer class="content-footer">
            <div id="footer">&copy; @DateTime.Now.Year Aydin Wylde | Full-Stack Developer</div>
        </footer>
    </div>

    <button id="backToTop" title="Back to top"><i class="fas fa-chevron-up"></i></button>
    <div id="matrix-cursor"><span id="cursor-char">A</span></div>

    <!-- Add search index script -->
    <script src="~/js/search-index.js"></script>
    
    <script>
        // ========================================
        // PROFESSIONAL LOADING SCREEN
        // ========================================
        (function initLoader() {
            const loader = document.getElementById('pageLoader');
            const progress = document.querySelector('.loader-progress');
            const status = document.querySelector('.loader-status');
            
            if (!loader || !progress) return;
            
            const loadingMessages = [
                'Initializing',
                'Loading assets',
                'Preparing interface',
                'Almost ready',
                'Welcome'
            ];
            
            let currentProgress = 0;
            let messageIndex = 0;
            
            function updateProgress() {
                currentProgress += Math.random() * 20 + 10;
                if (currentProgress > 100) currentProgress = 100;
                
                progress.style.width = currentProgress + '%';
                
                // Update loading message
                const newIndex = Math.floor((currentProgress / 100) * (loadingMessages.length - 1));
                if (newIndex !== messageIndex && status) {
                    messageIndex = newIndex;
                    status.textContent = loadingMessages[messageIndex];
                }
                
                if (currentProgress < 100) {
                    setTimeout(updateProgress, 80 + Math.random() * 100);
                } else {
                    completeLoading();
                }
            }
            
            function completeLoading() {
                setTimeout(() => {
                    loader.classList.add('hidden');
                    document.body.style.overflow = '';
                }, 400);
            }
            
            // Start loading animation
            document.body.style.overflow = 'hidden';
            
            // Fail-safe: ensure loading completes within 3 seconds
            setTimeout(completeLoading, 3000);
            
            // Start progress animation
            setTimeout(updateProgress, 200);
        })();

        // ========================================
        // ENHANCED MOUSE EFFECTS & PARALLAX
        // ========================================
        (function initMouseEffects() {
            const mouseGlow = document.getElementById('mouse-glow');
            const trailContainer = document.getElementById('mouse-trail');
            
            // Skip on touch devices
            if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) {
                if (mouseGlow) mouseGlow.style.display = 'none';
                document.body.style.cursor = 'auto';
                return;
            }
            
            let mouseX = 0, mouseY = 0;
            let glowX = 0, glowY = 0;
            let lastTrailTime = 0;
            
            // Smooth glow follow
            function animateGlow() {
                glowX += (mouseX - glowX) * 0.1;
                glowY += (mouseY - glowY) * 0.1;
                
                if (mouseGlow) {
                    mouseGlow.style.left = glowX + 'px';
                    mouseGlow.style.top = glowY + 'px';
                }
                
                requestAnimationFrame(animateGlow);
            }
            animateGlow();
            
            // Trail effect
            function createTrailParticle(x, y) {
                if (!trailContainer) return;
                
                const particle = document.createElement('div');
                particle.className = 'trail-particle';
                particle.style.left = (x - 3) + 'px';
                particle.style.top = (y - 3) + 'px';
                trailContainer.appendChild(particle);
                
                setTimeout(() => {
                    particle.remove();
                }, 800);
            }
            
            // Card tilt effect
            function handleCardTilt(card, e) {
                const rect = card.getBoundingClientRect();
                const centerX = rect.left + rect.width / 2;
                const centerY = rect.top + rect.height / 2;
                
                const deltaX = (e.clientX - centerX) / (rect.width / 2);
                const deltaY = (e.clientY - centerY) / (rect.height / 2);
                
                const rotateX = deltaY * -10; // Max 10 degrees
                const rotateY = deltaX * 10;
                
                card.style.transform = `perspective(1000px) rotateX(${rotateX}deg) rotateY(${rotateY}deg) scale3d(1.02, 1.02, 1.02)`;
                card.classList.add('tilt-active');
            }
            
            function resetCardTilt(card) {
                card.style.transform = '';
                card.classList.remove('tilt-active');
            }
            
            // Apply tilt to interactive cards
            function setupCardTilt() {
                const cards = document.querySelectorAll('.portfolio-card, .blog-card, .counter-item, .blog-hero-card, .skill-card');
                
                cards.forEach(card => {
                    card.addEventListener('mousemove', (e) => handleCardTilt(card, e));
                    card.addEventListener('mouseleave', () => resetCardTilt(card));
                });
            }
            
            // Global mouse move handler
            document.addEventListener('mousemove', (e) => {
                mouseX = e.clientX;
                mouseY = e.clientY;
                
                // Create trail particles (throttled)
                const now = Date.now();
                if (now - lastTrailTime > 50) {
                    createTrailParticle(e.clientX, e.clientY);
                    lastTrailTime = now;
                }
            });
            
            // Hide effects when mouse leaves window
            document.addEventListener('mouseleave', () => {
                if (mouseGlow) mouseGlow.classList.add('hidden');
            });
            
            document.addEventListener('mouseenter', () => {
                if (mouseGlow) mouseGlow.classList.remove('hidden');
            });
            
            // Setup card tilt on DOM ready
            if (document.readyState === 'loading') {
                document.addEventListener('DOMContentLoaded', setupCardTilt);
            } else {
                setupCardTilt();
            }
        })();

        // Matrix code effect always running
        (function initMatrix() {
            var canvas = document.getElementById('matrix-bg');
            if (!canvas) return;
            var ctx = canvas.getContext && canvas.getContext('2d');
            if (!ctx) return;

            var letters = ('01ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%*+-/').split('');
            var fontSize = 14;
            var columns;
            var drops;

            function resize() {
                canvas.width = window.innerWidth;
                canvas.height = window.innerHeight;
                columns = Math.max(1, Math.floor(canvas.width / fontSize));
                drops = new Array(columns).fill(1);
            }

            resize();
            window.addEventListener('resize', resize);

            function draw() {
                ctx.fillStyle = 'rgba(0,0,0,0.1)';
                ctx.fillRect(0, 0, canvas.width, canvas.height);
                const greenShades = ['#00ff00', '#00dd00', '#00bb00', '#009900'];
                ctx.font = fontSize + 'px monospace';
                for (var i = 0; i < drops.length; i++) {
                    const shade = greenShades[Math.floor(Math.random() * greenShades.length)];
                    ctx.fillStyle = shade;
                    var text = letters[Math.floor(Math.random() * letters.length)];
                    ctx.fillText(text, i * fontSize, drops[i] * fontSize);
                    if (drops[i] * fontSize > canvas.height && Math.random() > 0.975) { drops[i] = 0; }
                    drops[i]++;
                }
            }
            setInterval(draw, 50);
        })();

        // Mobile menu toggle
        document.getElementById('mobileMenuToggle').addEventListener('click', function() {
            document.getElementById('main-nav').classList.toggle('active');
            this.querySelector('i').classList.toggle('fa-bars');
            this.querySelector('i').classList.toggle('fa-times');
        });

        // Mobile menu dropdown toggle
        document.addEventListener('DOMContentLoaded', function() {
            const menuItems = document.querySelectorAll('.main-menu-item');
            
            if (window.innerWidth <= 768) {
                menuItems.forEach(item => {
                    const hasDropdown = item.querySelector('.dropdown-menu');
                    if (hasDropdown) {
                        const link = item.querySelector('.main-menu-link');
                        link.addEventListener('click', function(e) {
                            e.preventDefault();
                            item.classList.toggle('active');
                        });
                    }
                });
            }
            
            // Setup search form submission
            const searchForm = document.getElementById('searchForm');
            const searchInput = document.getElementById('globalSearch');
            
            if (searchForm && searchInput) {
                searchForm.addEventListener('submit', function(e) {
                    // Only submit if search has at least 3 characters
                    if (searchInput.value.trim().length < 3) {
                        e.preventDefault();
                    }
                });
            }
        });

        // Navigation click handling with smooth transitions
        document.querySelectorAll('.main-menu-link').forEach(link => {
            if (!link.closest('.main-menu-item').classList.contains('active')) {
                link.addEventListener('click', function(e) {
                    if (e.currentTarget.getAttribute('href').includes('#')) return;
                    e.preventDefault();
                    
                    const url = e.currentTarget.getAttribute('href');
                    const transition = document.getElementById('pageTransition');
                    transition.classList.add('active');
                    
                    document.getElementById('main-nav').classList.remove('active');
                    
                    setTimeout(() => {
                        window.location.href = url;
                    }, 300);
                });
            }
        });

        // Enhanced Back to top button logic (always visible)
        (function initBackToTop() {
            const btn = document.getElementById('backToTop');
            if (!btn) return;
            const container = document.querySelector('.parallax-container');
            
            container.addEventListener('scroll', function () {
                if (container.scrollTop > 300) {
                    btn.style.opacity = "1";
                } else {
                    btn.style.opacity = "0.5";
                }
            });
            
            btn.addEventListener('click', function () { 
                container.scrollTo({ 
                    top: 0, 
                    behavior: 'smooth' 
                }); 
            });
        })();

        // Enhanced matrix cursor
        (function initMatrixCursor() {
            const cursor = document.getElementById('matrix-cursor');
            const charSpan = document.getElementById('cursor-char');
            if (!cursor || !charSpan) {
                console.log('Matrix cursor elements not found');
                return;
            }

            // Hide on touch devices
            if (window.matchMedia && window.matchMedia('(pointer: coarse)').matches) {
                cursor.style.display = 'none';
                document.body.style.cursor = 'auto';
                return;
            }

            const chars = '01ABCDEFGHIJKLMNOPQRSTUVWXYZ#$%&*';
            function randChar() { return chars[Math.floor(Math.random() * chars.length)]; }
            setInterval(function () { charSpan.textContent = randChar(); }, 80);

            // Position tracking
            let currentX = window.innerWidth / 2;
            let currentY = window.innerHeight / 2;
            let targetX = currentX;
            let targetY = currentY;
            
            // Get cursor element dimensions for centering
            const cursorSize = 54;
            const offset = cursorSize / 2;
            
            // Set initial position
            cursor.style.left = '0px';
            cursor.style.top = '0px';
            cursor.style.opacity = '1';

            // Animation loop - runs continuously
            function animate() {
                // Smooth interpolation
                currentX += (targetX - currentX) * 0.15;
                currentY += (targetY - currentY) * 0.15;
                
                // Apply transform
                cursor.style.transform = 'translate3d(' + (currentX - offset) + 'px, ' + (currentY - offset) + 'px, 0)';
                
                requestAnimationFrame(animate);
            }
            
            // Start animation immediately
            animate();

            // Update target position on mouse move
            document.addEventListener('mousemove', function(e) {
                targetX = e.clientX;
                targetY = e.clientY;
                cursor.style.opacity = '1';
            }, { passive: true });

            // Hide when mouse leaves document
            document.addEventListener('mouseleave', function() {
                cursor.style.opacity = '0';
            });
            
            // Show when mouse enters document
            document.addEventListener('mouseenter', function(e) {
                targetX = e.clientX;
                targetY = e.clientY;
                currentX = e.clientX;
                currentY = e.clientY;
                cursor.style.opacity = '1';
            });

            // Hide on touch
            window.addEventListener('touchstart', function () { 
                cursor.style.display = 'none'; 
                document.body.style.cursor = 'auto';
            }, { passive: true });
        })();

        // Enhanced parallax scroll effect with smooth animations
        (function initParallax() {
            const container = document.querySelector('.parallax-container');
            const sections = document.querySelectorAll('.parallax-section');
            
            if (!sections.length) return;
            
            let ticking = false;
            
            function updateParallax() {
                const scrolled = container.scrollTop;
                const windowHeight = window.innerHeight;
                
                sections.forEach((section, index) => {
                    const sectionTop = section.offsetTop;
                    const sectionHeight = section.offsetHeight;
                    const sectionCenter = sectionTop + sectionHeight / 2;
                    const distanceFromCenter = scrolled + windowHeight / 2 - sectionCenter;
                    const normalizedDistance = distanceFromCenter / windowHeight;
                    
                    // Enhanced parallax with multiple effects
                    if (scrolled + windowHeight > sectionTop && scrolled < sectionTop + sectionHeight) {
                        const yPos = normalizedDistance * 30; // Reduced movement for smoother effect
                        const scale = 1 + Math.abs(normalizedDistance) * 0.05;
                        
                        section.style.transform = `translateY(${yPos}px) scale(${Math.max(0.95, Math.min(1.05, scale))})`;
                    }
                });
                
                ticking = false;
            }
            
            container.addEventListener('scroll', () => {
                if (!ticking) {
                    requestAnimationFrame(updateParallax);
                    ticking = true;
                }
            });
        })();

        // Fixed counter animation to ensure counting works
        function animateCounters() {
            const counters = document.querySelectorAll('.counter-number');
            counters.forEach((counter, index) => {
                const target = parseInt(counter.getAttribute('data-target'));
                const duration = 2000;
                const frameRate = 60;
                const frameDuration = 1000 / frameRate;
                const totalFrames = duration / frameDuration;
                const increment = target / totalFrames;
                
                let current = 0;
                let frame = 0;
                
                // Reset counter if it was previously animated
                counter.textContent = '0';
                
                const timer = setInterval(() => {
                    frame++;
                    current += increment;
                    counter.textContent = Math.round(current);
                    
                    if (frame >= totalFrames) {
                        counter.textContent = target;
                        clearInterval(timer);
                    }
                }, frameDuration);
            });
        }

        // Improved intersection observer for counter animations
        const observer = new IntersectionObserver((entries) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    if (entry.target.classList.contains('counters-section')) {
                        animateCounters();
                        observer.unobserve(entry.target);
                    }
                }
            });
        }, { threshold: 0.2 });

        // Page initialization
        document.addEventListener('DOMContentLoaded', () => {
            // Observe counter sections
            const countersSections = document.querySelectorAll('.counters-section');
            countersSections.forEach(section => observer.observe(section));
            
            // Remove page transition on load
            const transition = document.getElementById('pageTransition');
            setTimeout(() => {
                transition.classList.remove('active');
            }, 100);
        });

        // ============================================
        // ADMIN PANEL - Secret Key Combination Handler
        // Press: Ctrl + Shift + A + W (in sequence)
        // ============================================
        (function initAdminPanel() {
            // Admin dialog hotkey: Alt+Shift+A (safe, no browser conflicts)
            document.addEventListener('keydown', function(e) {
                // Alt+Shift+A - doesn't conflict with Edge or Chrome shortcuts
                if (e.altKey && e.shiftKey && (e.key === 'A' || e.key === 'a')) {
                    e.preventDefault();
                    openAdminModal();
                }
            });
        })();

        // Admin Modal Functions
        let isAdminInitialized = false;

        function openAdminModal() {
            const modal = document.getElementById('adminModal');
            modal.classList.remove('hidden');
            showLoginScreen();
        }

        function closeAdminModal() {
            document.getElementById('adminModal').classList.add('hidden');
            resetAllScreens();
        }

        function showScreen(screenId) {
            document.querySelectorAll('.admin-screen').forEach(s => s.classList.add('hidden'));
            document.getElementById(screenId).classList.remove('hidden');
        }

        function resetAllScreens() {
            showScreen('adminLoginScreen');
            document.getElementById('loginUsername').value = '';
            document.getElementById('loginPassword').value = '';
            document.getElementById('loginMessage').classList.add('hidden');
        }

        function showLoginScreen() {
            showScreen('adminLoginScreen');
        }

        async function handleLogin(event) {
            event.preventDefault();
            
            const username = document.getElementById('loginUsername').value;
            const password = document.getElementById('loginPassword').value;
            const messageEl = document.getElementById('loginMessage');
            
            messageEl.classList.add('hidden');
            
            try {
                const response = await fetch('/api/admin/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ username, password })
                });
                
                const data = await response.json();
                
                if (response.ok) {
                    messageEl.textContent = 'Login successful!';
                    messageEl.classList.remove('error');
                    messageEl.classList.add('success');
                    messageEl.classList.remove('hidden');
                    
                    setTimeout(() => showDashboardScreen(), 500);
                } else {
                    messageEl.textContent = data.error || 'Invalid credentials';
                    messageEl.classList.remove('success');
                    messageEl.classList.add('error');
                    messageEl.classList.remove('hidden');
                }
            } catch (error) {
                messageEl.textContent = 'Connection error. Please try again.';
                messageEl.classList.remove('success');
                messageEl.classList.add('error');
                messageEl.classList.remove('hidden');
            }
        }

        async function logoutAdmin() {
            try {
                await fetch('/api/admin/logout', { method: 'POST' });
            } catch (error) {}
            showLoginScreen();
        }

        function showDashboardScreen() {
            showScreen('adminDashboard');
            switchTab('analytics');
            loadDashboardData();
        }

        function switchTab(tabName) {
            // Update tab buttons
            document.querySelectorAll('.admin-tab-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            event?.currentTarget?.classList.add('active');
            
            // Show selected tab content
            document.querySelectorAll('.tab-pane').forEach(pane => {
                pane.classList.remove('active');
            });
            document.getElementById('tab-' + tabName)?.classList.add('active');
            
            // Load tab data
            if (tabName === 'blog') {
                loadBlogPosts();
            }
        }

        async function loadDashboardData() {
            try {
                const response = await fetch('/api/admin/dashboard');
                if (!response.ok) {
                    showLoginScreen();
                    return;
                }
                
                const data = await response.json();
                
                // Update stats
                document.getElementById('stat-today').textContent = data.TodayVisitors || 0;
                document.getElementById('stat-week').textContent = data.ThisWeekVisitors || 0;
                document.getElementById('stat-month').textContent = data.ThisMonthVisitors || 0;
                document.getElementById('stat-total').textContent = data.TotalVisitors || 0;
                
                // Show recent activity
                const activityHtml = '<div style="color: rgba(0,255,120,0.7);">Activity monitoring coming soon...</div>';
                document.getElementById('recentActivity').innerHTML = activityHtml;
                
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        async function loadBlogPosts() {
            try {
                const response = await fetch('/api/admin/blog/posts');
                if (!response.ok) return;
                
                const posts = await response.json();
                const listEl = document.getElementById('blogPostsList');
                
                if (posts.length === 0) {
                    listEl.innerHTML = '<div style="text-align:center; color:rgba(0,255,120,0.6); padding:40px;">No blog posts yet. Create your first post!</div>';
                    return;
                }
                
                listEl.innerHTML = posts.map(post => `
                    <div class="blog-item">
                        <div class="blog-item-info">
                            <h4>${post.title}</h4>
                            <div class="blog-item-meta">
                                <span>${post.category}</span> • 
                                <span>${post.date}</span>
                                ${post.featured ? ' • <strong style="color:#00ff7a">Featured</strong>' : ''}
                            </div>
                        </div>
                        <div class="blog-item-actions">
                            <button class="admin-btn-secondary" onclick="editPost('${post.id}')">
                                <i class="fas fa-edit"></i> Edit
                            </button>
                            <button class="admin-btn-secondary" onclick="deletePost('${post.id}')" style="border-color:rgba(255,80,80,0.4); color:#ff5050;">
                                <i class="fas fa-trash"></i> Delete
                            </button>
                        </div>
                    </div>
                `).join('');
            } catch (error) {
                console.error('Error loading posts:', error);
            }
        }

        function showNewPostForm() {
            document.getElementById('postFormTitle').textContent = 'New Blog Post';
            document.getElementById('postId').value = '';
            document.getElementById('postTitle').value = '';
            document.getElementById('postCategory').value = 'ASP.NET Core';
            document.getElementById('postSummary').value = '';
            document.getElementById('postContent').value = '';
            document.getElementById('postTags').value = '';
            document.getElementById('postFeatured').checked = false;
            
            showScreen('postEditorScreen');
        }

        async function editPost(postId) {
            try {
                const response = await fetch(`/api/admin/blog/post/${postId}`);
                if (!response.ok) return;
                
                const post = await response.json();
                
                document.getElementById('postFormTitle').textContent = 'Edit Blog Post';
                document.getElementById('postId').value = post.Id;
                document.getElementById('postTitle').value = post.Title;
                document.getElementById('postCategory').value = post.Category;
                document.getElementById('postSummary').value = post.Summary;
                document.getElementById('postContent').value = post.Content;
                document.getElementById('postTags').value = post.Tags;
                document.getElementById('postFeatured').checked = post.Featured;
                
                showScreen('postEditorScreen');
            } catch (error) {
                alert('Error loading post');
            }
        }

        async function savePost(event) {
            event.preventDefault();
            
            const postData = {
                id: document.getElementById('postId').value || null,
                title: document.getElementById('postTitle').value,
                category: document.getElementById('postCategory').value,
                summary: document.getElementById('postSummary').value,
                content: document.getElementById('postContent').value,
                tags: document.getElementById('postTags').value,
                featured: document.getElementById('postFeatured').checked
            };
            
            try {
                const url = postData.id ? `/api/admin/blog/update/${postData.id}` : '/api/admin/blog/create';
                const response = await fetch(url, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(postData)
                });
                
                if (response.ok) {
                    alert('Post saved successfully!');
                    showDashboardScreen();
                    switchTab('blog');
                } else {
                    alert('Error saving post');
                }
            } catch (error) {
                alert('Error saving post');
            }
        }

        async function deletePost(postId) {
            if (!confirm('Are you sure you want to delete this post?')) return;
            
            try {
                const response = await fetch(`/api/admin/blog/delete/${postId}`, {
                    method: 'POST'
                });
                
                if (response.ok) {
                    loadBlogPosts();
                } else {
                    alert('Error deleting post');
                }
            } catch (error) {
                alert('Error deleting post');
            }
        }

        function cancelPostEdit() {
            showDashboardScreen();
            switchTab('blog');
        }
                
                // Render recent visitors
                const visitors = data.RecentVisitors || [];
                const visitorsHtml = visitors.slice(0, 10).map(v => 
                    `<tr>
                        <td>${new Date(v.VisitTime).toLocaleString()}</td>
                        <td>${v.PageVisited}</td>
                        <td>${v.Browser}</td>
                        <td>${v.DeviceType}</td>
                    </tr>`
                ).join('');
                document.getElementById('recentVisitorsTable').innerHTML = 
                    `<table class="admin-table">
                        <thead><tr><th>Time</th><th>Page</th><th>Browser</th><th>Device</th></tr></thead>
                        <tbody>${visitorsHtml || '<tr><td colspan="4">No visitors yet</td></tr>'}</tbody>
                    </table>`;
            } catch (error) {
                console.error('Error loading dashboard:', error);
            }
        }

        // Close modal on Escape key
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape' && !document.getElementById('adminModal').classList.contains('hidden')) {
                closeAdminModal();
            }
        });
    </script>

@* Render optional page Scripts section (fixes unrendered 'Scripts' exception) *@
@RenderSection("Scripts", required: false)
</body>
</html>
